from __future__ import annotations

import os
import requests
import humanize
import pandas as pd
import geopandas as gpd
import xarray as xr

from pandas import DataFrame
from geopandas import GeoDataFrame
from xarray import Dataset

from wondergrid.datasets.core import Dataset, DatasetBuilder, register_dataset_builder_cls
from wondergrid.datasets.core import utils
from wondergrid.datasets.smartmeter import SmartMeterDataset


class DMKDataset(SmartMeterDataset):
  
  def __init__(self, profiles: Dataset, labels: DataFrame, locations: DataFrame):
    super().__init__(profiles, labels, locations)

  def filter(self, n: int = None, hp: bool = None, ev: bool = None, pv: bool = None) -> DMKDataset:
    mask_hp = ((hp == None) | (self.labels['hp'] == hp))
    mask_ev = ((ev == None) | (self.labels['ev'] == ev))
    mask_pv = ((pv == None) | (self.labels['pv'] == pv))
    mask = (mask_hp & mask_ev & mask_pv).to_numpy()

    profiles = self.profiles.loc[{'id': mask}].head({'id': n}) if n is not None else self.profiles.loc[{'id': mask}]
    labels = self.labels.loc[mask].head(n) if n is not None else self.labels.loc[mask]
    locations = self.locations.loc[mask].head(n) if n is not None else self.locations.loc[mask]

    return DMKDataset(profiles, labels, locations)

  def add_municipalities(self, municipalities: GeoDataFrame) -> DMKDataset:
    municipalities = municipalities.rename_geometry('shape')
    municipalities['location'] = municipalities.centroid
    coordinates = municipalities['location'].to_crs('EPSG:4326')
    municipalities['longitude'] = coordinates.x
    municipalities['latitude'] = coordinates.y
    locations = self.locations.join(municipalities, on='municipality')
    return DMKDataset(self.profiles, self.labels, locations)

  def add_postal_districts(self, postaldistricts: GeoDataFrame) -> DMKDataset:
    postaldistricts = postaldistricts.rename_geometry('shape')
    postaldistricts['location'] = postaldistricts.centroid
    coordinates = postaldistricts['location'].to_crs('EPSG:4326')
    postaldistricts['longitude'] = coordinates.x
    postaldistricts['latitude'] = coordinates.y
    locations = self.locations.join(postaldistricts, on='postalcode')
    return DMKDataset(self.profiles, self.labels, locations)


class DMKDatasetBuilder(DatasetBuilder):

  name = 'fluvius/dmk'

  def __init__(self):
    super().__init__()


  def download_and_prepare(self):
    print(f'downloading and preparing {self.name} dataset ...')

    metadata_url = 'https://opendata.fluvius.be/api/datasets/1.0/1_50-verbruiksprofielen-dm-elek-kwartierwaarden-voor-een-volledig-jaar'
    print(f'fetching dataset metadata from {metadata_url}')
    response = requests.get(metadata_url)
    response.raise_for_status()
    metadata = response.json()

    data_path = self.get_data_path()

    data_file_path = None

    for attachment in metadata['attachments']:
      
      data_url = f'https://opendata.fluvius.be/api/datasets/1.0/1_50-verbruiksprofielen-dm-elek-kwartierwaarden-voor-een-volledig-jaar/attachments/{attachment["id"]}'    
      file_path = os.path.join(data_path, attachment['title'])
      
      file_path = utils.download(data_url, file_path)
      
      if attachment['mimetype'] == 'application/zip':

        file_paths = utils.extract_deflate64_zip(file_path)
        data_file_path = file_paths[0]

    assert data_file_path is not None        

    location_file_path = os.path.join(self.get_data_path(), 'DRM-4780 Postcodes OpenDataVerbruiksprofielen Elektriciteit.csv')
    print(f'generating hardcoded location metadata file ...')
    if os.path.exists(location_file_path):
      print(f'skipped generation, file {location_file_path} already exists')
    else:
      with open(location_file_path, 'w') as location_file:
        location_file.write(DMK_LOCATION_DATA)
      print(f'saved generated file to {location_file_path} ({humanize.naturalsize(os.path.getsize(location_file_path))})')

    print(f'transforming profiles, labels and locations ...')

    profiles_path, labels_path, locations_path = self._get_data_file_paths()

    if os.path.exists(profiles_path) and os.path.exists(labels_path):
      print(f'skipped profile transform, file {profiles_path} already exists')
      print(f'skipped label transform, file {labels_path} already exists')
    else:
      print(f'reading and parsing csv file {data_file_path} ...')
      column_names_dmk = ['id', 'date', 'timestamp', 'load', 'feedin', 'hp' , 'ev', 'pv', 'category']
      df_dmk = pd.read_csv(data_file_path, delimiter=';', header=0, names=column_names_dmk, usecols=['id', 'timestamp', 'load', 'feedin', 'hp' , 'ev', 'pv'])
      # df_dmk[['load', 'feedin']] = df_dmk[['load', 'feedin']] * 4 * 1000    # transform kWh to W for data sampled at 15 minutes
      df_dmk['timestamp'] = pd.to_datetime(df_dmk['timestamp']).dt.tz_localize(None)
      df_dmk = df_dmk.set_index(['id', 'timestamp'])

      xr_dmk = df_dmk[['load', 'feedin']].to_xarray()
      xr_dmk.to_netcdf(profiles_path, engine='netcdf4')
      print(f'saved profiles to netcdf4 file {profiles_path}')

      df_dmk_labels = df_dmk[['hp', 'ev', 'pv']].groupby(level='id').mean()
      df_dmk_labels.to_csv(labels_path)
      print(f'saved labels to csv file {labels_path}')

    if os.path.exists(locations_path):
      print(f'skipped location transform, file {locations_path} already exists')
    else:
      print(f'reading and parsing csv file {location_file_path} ...')
      column_names_dmk_locations = ['id', 'postalcode', 'municipality']
      df_dmk_locations = pd.read_csv(location_file_path, delimiter=';', header=0, names=column_names_dmk_locations, index_col=['id'])
      df_dmk_locations['postalcode'] = df_dmk_locations['postalcode'].astype(str)
      df_dmk_locations['municipality'] = df_dmk_locations['municipality'].astype(str).str.casefold()
      df_dmk_locations.to_csv(locations_path)
      print(f'saved locations to csv file {locations_path}')

        
  def load_as_dataset(self) -> DMKDataset:
    print(f'loading {self.name} as dataset ...')

    data_file_paths = self._get_data_file_paths()
    
    for data_file_path in data_file_paths:
      if not os.path.exists(data_file_path):
        raise FileNotFoundError()
    
    profiles_path, labels_path, locations_path = data_file_paths

    profiles = xr.open_dataset(profiles_path)
    labels = pd.read_csv(labels_path, index_col='id').sort_index()
    locations = pd.read_csv(locations_path, index_col='id', dtype={'postalcode': str, 'municipality': str}).sort_index()

    return DMKDataset(profiles, labels, locations)


  def _get_data_file_paths(self):
    data_path = self.get_data_path()
    profiles_path = os.path.join(data_path, 'fluvius_dmk_sample_1300.nc')
    labels_path = os.path.join(data_path, 'fluvius_dmk_sample_1300_labels.csv')
    locations_path = os.path.join(data_path, 'fluvius_dmk_sample_1300_locations.csv')
    return (profiles_path, labels_path, locations_path)


register_dataset_builder_cls(DMKDatasetBuilder)


DMK_LOCATION_DATA = """
EAN_ID;Postcode;Gemeente
1;2500;LIER
2;9880;AALTER
3;9880;AALTER
4;2630;AARTSELAAR
5;2390;MALLE
6;8340;DAMME
7;2960;BRECHT
8;2018;ANTWERPEN
9;2020;ANTWERPEN
10;9080;LOCHRISTI
11;2000;ANTWERPEN
12;2000;ANTWERPEN
13;9290;BERLARE
14;9240;ZELE
15;2050;ANTWERPEN
16;2242;ZANDHOVEN
17;8730;BEERNEM
18;8730;BEERNEM
19;2600;ANTWERPEN
20;2600;ANTWERPEN
21;2600;ANTWERPEN
22;2600;ANTWERPEN
23;2600;ANTWERPEN
24;2600;ANTWERPEN
25;9130;BEVEREN
26;2160;WOMMELGEM
27;9120;BEVEREN
28;9120;BEVEREN
29;9120;BEVEREN
30;9130;BEVEREN
31;8370;BLANKENBERGE
32;2850;BOOM
33;2850;BOOM
34;2850;BOOM
35;2850;BOOM
36;2930;BRASSCHAAT
37;2140;ANTWERPEN
38;2140;ANTWERPEN
39;2140;ANTWERPEN
40;2140;ANTWERPEN
41;2930;BRASSCHAAT
42;2930;BRASSCHAAT
43;2930;BRASSCHAAT
44;8200;BRUGGE
45;2930;BRASSCHAAT
46;2930;BRASSCHAAT
47;2960;BRECHT
48;2960;BRECHT
49;2960;BRECHT
50;8450;BREDENE
51;9290;BERLARE
52;9290;BERLARE
53;2340;BEERSE
54;2340;BEERSE
55;8200;BRUGGE
56;8200;BRUGGE
57;9255;BUGGENHOUT
58;8310;BRUGGE
59;8310;BRUGGE
60;8450;BREDENE
61;9070;DESTELBERGEN
62;9070;DESTELBERGEN
63;2100;ANTWERPEN
64;2100;ANTWERPEN
65;2100;ANTWERPEN
66;2100;ANTWERPEN
67;2100;ANTWERPEN
68;2100;ANTWERPEN
69;2100;ANTWERPEN
70;2100;ANTWERPEN
71;2100;ANTWERPEN
72;2100;ANTWERPEN
73;2100;ANTWERPEN
74;2100;ANTWERPEN
75;2100;ANTWERPEN
76;2100;ANTWERPEN
77;2100;ANTWERPEN
78;2570;DUFFEL
79;2650;EDEGEM
80;2650;EDEGEM
81;2180;ANTWERPEN
82;9940;EVERGEM
83;9940;EVERGEM
84;2610;ANTWERPEN
85;2370;ARENDONK
86;2370;ARENDONK
87;2370;ARENDONK
88;2920;KALMTHOUT
89;8450;BREDENE
90;2491;BALEN
91;9050;GENT
92;9030;GENT
93;9041;GENT
94;9032;GENT
95;9050;GENT
96;9052;GENT
97;9032;GENT
98;9031;GENT
99;9050;GENT
100;9031;GENT
101;9030;GENT
102;9050;GENT
103;9051;GENT
104;2180;ANTWERPEN
105;2540;HOVE
106;2920;KALMTHOUT
107;2920;KALMTHOUT
108;2920;KALMTHOUT
109;2950;KAPELLEN
110;2950;KAPELLEN
111;2950;KAPELLEN
112;9910;AALTER
113;9910;AALTER
114;2550;KONTICH
115;2550;KONTICH
116;9150;KRUIBEKE
117;9150;KRUIBEKE
118;9270;LAARNE
119;9270;LAARNE
120;9270;LAARNE
121;9270;LAARNE
122;9340;LEDE
123;9340;LEDE
124;9340;LEDE
125;2490;BALEN
126;2500;LIER
127;2500;LIER
128;2500;LIER
129;2547;LINT
130;2547;LINT
131;2547;LINT
132;9080;LOCHRISTI
133;9080;LOCHRISTI
134;2170;ANTWERPEN
135;9080;LOCHRISTI
136;9160;LOKEREN
137;9160;LOKEREN
138;9160;LOKEREN
139;9160;LOKEREN
140;9160;LOKEREN
141;9160;LOKEREN
142;9160;LOKEREN
143;9160;LOKEREN
144;9160;LOKEREN
145;9160;LOKEREN
146;9160;LOKEREN
147;9160;LOKEREN
148;9920;LIEVEGEM
149;9920;LIEVEGEM
150;9991;MALDEGEM
151;2390;MALLE
152;2390;MALLE
153;2390;MALLE
154;9090;MELLE
155;2170;ANTWERPEN
156;2170;ANTWERPEN
157;2170;ANTWERPEN
158;2170;ANTWERPEN
159;2170;ANTWERPEN
160;2170;ANTWERPEN
161;2170;ANTWERPEN
162;2170;ANTWERPEN
163;9180;MOERBEKE
164;2640;MORTSEL
165;2640;MORTSEL
166;2640;MORTSEL
167;9820;MERELBEKE
168;9820;MERELBEKE
169;9310;AALST
170;8400;OOSTENDE
171;8400;OOSTENDE
172;8400;OOSTENDE
173;8400;OOSTENDE
174;8020;OOSTKAMP
175;2100;ANTWERPEN
176;2920;KALMTHOUT
177;8210;ZEDELGEM
178;2520;RANST
179;2310;RIJKEVORSEL
180;2970;SCHILDE
181;2900;SCHOTEN
182;2940;STABROEK
183;2940;STABROEK
184;9520;SINT-LIEVENS-HOUTEM
185;1653;BEERSEL
186;1652;BEERSEL
187;1650;BEERSEL
188;1703;DILBEEK
189;1701;DILBEEK
190;9185;WACHTEBEKE
191;9230;WETTEREN
192;9230;WETTEREN
193;9230;WETTEREN
194;9230;WETTEREN
195;9230;WETTEREN
196;9260;WICHELEN
197;2110;WIJNEGEM
198;2610;ANTWERPEN
199;2610;ANTWERPEN
200;2610;ANTWERPEN
201;2160;WOMMELGEM
202;2990;WUUSTWEZEL
203;8210;ZEDELGEM
204;8210;ZEDELGEM
205;9240;ZELE
206;9240;ZELE
207;9240;ZELE
208;9240;ZELE
209;2980;ZOERSEL
210;2980;ZOERSEL
211;9930;LIEVEGEM
212;9930;LIEVEGEM
213;8377;ZUIENKERKE
214;2070;ZWIJNDRECHT
215;2630;AARTSELAAR
216;2547;LINT
217;9940;EVERGEM
218;3040;HULDENBERG
219;9032;GENT
220;9040;GENT
221;3040;HULDENBERG
222;9000;GENT
223;9000;GENT
224;9000;GENT
225;9000;GENT
226;9000;GENT
227;9000;GENT
228;9000;GENT
229;9000;GENT
230;9000;GENT
231;9000;GENT
232;9000;GENT
233;9000;GENT
234;9000;GENT
235;2280;GROBBENDONK
236;2520;RANST
237;9520;SINT-LIEVENS-HOUTEM
238;1950;KRAAINEM
239;2500;LIER
240;2490;BALEN
241;3070;KORTENBERG
242;9230;WETTEREN
243;2550;KONTICH
244;3078;KORTENBERG
245;9810;NAZARETH
246;9910;AALTER
247;2930;BRASSCHAAT
248;2170;ANTWERPEN
249;3071;KORTENBERG
250;2070;ZWIJNDRECHT
251;2040;ANTWERPEN
252;1770;LIEDEKERKE
253;1630;LINKEBEEK
254;3090;OVERIJSE
255;3090;OVERIJSE
256;3090;OVERIJSE
257;3090;OVERIJSE
258;9820;MERELBEKE
259;8200;BRUGGE
260;2920;KALMTHOUT
261;8400;OOSTENDE
262;9840;DE PINTE
263;2280;GROBBENDONK
264;9160;LOKEREN
265;8020;OOSTKAMP
266;8730;BEERNEM
267;9090;MELLE
268;2920;KALMTHOUT
269;2950;KAPELLEN
270;2640;MORTSEL
271;8400;OOSTENDE
272;8000;BRUGGE
273;2920;KALMTHOUT
274;2930;BRASSCHAAT
275;2960;BRECHT
276;9230;WETTEREN
277;2920;KALMTHOUT
278;1740;TERNAT
279;2960;BRECHT
280;9080;LOCHRISTI
281;2170;ANTWERPEN
282;9080;LOCHRISTI
283;1740;TERNAT
284;2550;KONTICH
285;9340;LEDE
286;2390;MALLE
287;9860;OOSTERZELE
288;2610;ANTWERPEN
289;3080;TERVUREN
290;3080;TERVUREN
291;3080;TERVUREN
292;3080;TERVUREN
293;3080;TERVUREN
294;3080;TERVUREN
295;1970;WEZEMBEEK-OPPEM
296;1930;ZAVENTEM
297;2480;DESSEL
298;2440;GEEL
299;2440;GEEL
300;2200;HERENTALS
301;2200;HERENTALS
302;2270;HERENTHOUT
303;2270;HERENTHOUT
304;2270;HERENTHOUT
305;2321;HOOGSTRATEN
306;2323;HOOGSTRATEN
307;2321;HOOGSTRATEN
308;2460;KASTERLEE
309;2460;KASTERLEE
310;2275;LILLE
311;2275;LILLE
312;2275;LILLE
313;2450;MEERHOUT
314;2450;MEERHOUT
315;2830;WILLEBROEK
316;2400;MOL
317;2400;MOL
318;2260;WESTERLO
319;2360;OUD-TURNHOUT
320;2360;OUD-TURNHOUT
321;2382;RAVELS
322;2300;TURNHOUT
323;2300;TURNHOUT
324;2300;TURNHOUT
325;2300;TURNHOUT
326;2260;WESTERLO
327;2260;WESTERLO
328;2260;WESTERLO
329;2260;WESTERLO
330;2490;BALEN
331;3200;AARSCHOT
332;3200;AARSCHOT
333;3201;AARSCHOT
334;3200;AARSCHOT
335;3200;AARSCHOT
336;3200;AARSCHOT
337;3202;AARSCHOT
338;3202;AARSCHOT
339;1730;ASSE
340;1730;ASSE
341;1731;ASSE
342;3360;BIERBEEK
343;3360;BIERBEEK
344;2820;BONHEIDEN
345;2800;MECHELEN
346;2820;BONHEIDEN
347;3190;BOORTMEERBEEK
348;2880;BORNEM
349;2880;BORNEM
350;2880;BORNEM
351;2880;BORNEM
352;2880;BORNEM
353;2880;BORNEM
354;3150;HAACHT
355;1500;HALLE
356;2221;HEIST-OP-DEN-BERG
357;2220;HEIST-OP-DEN-BERG
358;9220;HAMME
359;3020;HERENT
360;3020;HERENT
361;3020;HERENT
362;3020;HERENT
363;2235;HULSHOUT
364;2235;HULSHOUT
365;2235;HULSHOUT
366;1880;KAPELLE-OP-DEN-BOS
367;3140;KEERBERGEN
368;3140;KEERBERGEN
369;3140;KEERBERGEN
370;3012;LEUVEN
371;3001;LEUVEN
372;3000;LEUVEN
373;3010;LEUVEN
374;3001;LEUVEN
375;3010;LEUVEN
376;3000;LEUVEN
377;1840;LONDERZEEL
378;1840;LONDERZEEL
379;2811;MECHELEN
380;2812;MECHELEN
381;2800;MECHELEN
382;2800;MECHELEN
383;2800;MECHELEN
384;2800;MECHELEN
385;2800;MECHELEN
386;2800;MECHELEN
387;1785;MERCHTEM
388;2870;PUURS-SINT-AMANDS
389;2870;PUURS-SINT-AMANDS
390;2870;PUURS-SINT-AMANDS
391;3111;ROTSELAAR
392;3271;SCHERPENHEUVEL-ZICHEM
393;3270;SCHERPENHEUVEL-ZICHEM
394;3271;SCHERPENHEUVEL-ZICHEM
395;2890;PUURS-SINT-AMANDS
396;2860;SINT-KATELIJNE-WAVER
397;2860;SINT-KATELIJNE-WAVER
398;2860;SINT-KATELIJNE-WAVER
399;3300;TIENEN
400;3300;TIENEN
401;3300;TIENEN
402;3300;TIENEN
403;3300;TIENEN
404;3300;TIENEN
405;3120;TREMELO
406;1980;ZEMST
407;1980;ZEMST
408;9320;AALST
409;9320;AALST
410;9320;AALST
411;9300;AALST
412;9300;AALST
413;9310;AALST
414;9300;AALST
415;9300;AALST
416;9300;AALST
417;9300;AALST
418;9300;AALST
419;8570;ANZEGEM
420;9300;AALST
421;9661;BRAKEL
422;9255;BUGGENHOUT
423;9255;BUGGENHOUT
424;9255;BUGGENHOUT
425;9200;DENDERMONDE
426;9200;DENDERMONDE
427;9200;DENDERMONDE
428;9200;DENDERMONDE
429;9200;DENDERMONDE
430;9200;DENDERMONDE
431;9200;DENDERMONDE
432;9200;DENDERMONDE
433;9470;DENDERLEEUW
434;9420;ERPE-MERE
435;9420;ERPE-MERE
436;9506;GERAARDSBERGEN
437;9506;GERAARDSBERGEN
438;9506;GERAARDSBERGEN
439;9220;HAMME
440;9220;HAMME
441;9220;HAMME
442;2860;SINT-KATELIJNE-WAVER
443;9220;HAMME
444;9550;HERZELE
445;9550;HERZELE
446;9280;LEBBEKE
447;9280;LEBBEKE
448;9400;NINOVE
449;9400;NINOVE
450;9190;STEKENE
451;9190;STEKENE
452;9190;STEKENE
453;9112;SINT-NIKLAAS
454;9140;TEMSE
455;9140;TEMSE
456;9250;WAASMUNSTER
457;9250;WAASMUNSTER
458;9250;WAASMUNSTER
459;9620;ZOTTEGEM
460;8850;ARDOOIE
461;8580;AVELGEM
462;8540;DEERLIJK
463;8421;DE HAAN
464;8720;DENTERGEM
465;8720;DENTERGEM
466;8660;DE PANNE
467;8660;DE PANNE
468;9890;GAVERE
469;8950;HEUVELLAND
470;8650;HOUTHULST
471;8480;ICHTEGEM
472;8480;ICHTEGEM
473;8480;ICHTEGEM
474;8480;ICHTEGEM
475;8900;IEPER
476;8900;IEPER
477;8770;INGELMUNSTER
478;9690;KLUISBERGEN
479;8670;KOKSIJDE
480;8670;KOKSIJDE
481;8670;KOKSIJDE
482;8500;KORTRIJK
483;8500;KORTRIJK
484;8500;KORTRIJK
485;8500;KORTRIJK
486;8501;KORTRIJK
487;8500;KORTRIJK
488;8501;KORTRIJK
489;8501;KORTRIJK
490;8510;KORTRIJK
491;8501;KORTRIJK
492;8501;KORTRIJK
493;9770;KRUISEM
494;8520;KUURNE
495;8920;LANGEMARK-POELKAPELLE
496;9681;MAARKEDAL
497;9681;MAARKEDAL
498;8930;MENEN
499;8930;MENEN
500;8930;MENEN
501;8930;MENEN
502;8930;MENEN
503;8760;MEULEBEKE
504;8890;MOORSLEDE
505;9810;NAZARETH
506;8620;NIEUWPOORT
507;9700;OUDENAARDE
508;9700;OUDENAARDE
509;9700;OUDENAARDE
510;9700;OUDENAARDE
511;8970;POPERINGE
512;8970;POPERINGE
513;8970;POPERINGE
514;8800;ROESELARE
515;8800;ROESELARE
516;8800;ROESELARE
517;2340;BEERSE
518;8840;STADEN
519;8700;TIELT
520;8630;VEURNE
521;8790;WAREGEM
522;8790;WAREGEM
523;8940;WERVIK
524;8940;WERVIK
525;8710;WIELSBEKE
526;8710;WIELSBEKE
527;8750;WINGENE
528;8750;WINGENE
529;8750;WINGENE
530;9790;WORTEGEM-PETEGEM
531;8980;ZONNEBEKE
532;8980;ZONNEBEKE
533;8980;ZONNEBEKE
534;8980;ZONNEBEKE
535;8980;ZONNEBEKE
536;8980;ZONNEBEKE
537;1933;ZAVENTEM
538;8550;ZWEVEGEM
539;8510;KORTRIJK
540;1653;BEERSEL
541;9220;HAMME
542;1750;LENNIK
543;9820;MERELBEKE
544;8750;WINGENE
545;8670;KOKSIJDE
546;2340;BEERSE
547;2340;BEERSE
548;2970;SCHILDE
549;8750;WINGENE
550;9880;AALTER
551;2460;KASTERLEE
552;9031;GENT
553;8970;POPERINGE
554;2240;ZANDHOVEN
555;8380;BRUGGE
556;1850;GRIMBERGEN
557;1850;GRIMBERGEN
558;1852;GRIMBERGEN
559;1850;GRIMBERGEN
560;1850;GRIMBERGEN
561;1850;GRIMBERGEN
562;1831;MACHELEN
563;1860;MEISE
564;1860;MEISE
565;1800;VILVOORDE
566;9800;DEINZE
567;8480;ICHTEGEM
568;2940;STABROEK
569;9031;GENT
570;9080;LOCHRISTI
571;3201;AARSCHOT
572;9051;GENT
573;1745;OPWIJK
574;9820;MERELBEKE
575;3191;BOORTMEERBEEK
576;9910;AALTER
577;9240;ZELE
578;8900;IEPER
579;9240;ZELE
580;2150;BORSBEEK
581;9230;WETTEREN
582;2340;BEERSE
583;8700;TIELT
584;9880;AALTER
585;3370;BOUTERSEM
586;3370;BOUTERSEM
587;8210;ZEDELGEM
588;2940;STABROEK
589;9050;GENT
590;2340;BEERSE
591;9031;GENT
592;1730;ASSE
593;1653;BEERSEL
594;2940;STABROEK
595;9620;ZOTTEGEM
596;9112;SINT-NIKLAAS
597;9080;LOCHRISTI
598;8620;NIEUWPOORT
599;2320;HOOGSTRATEN
600;3061;BERTEM
601;9240;ZELE
602;2370;ARENDONK
603;9030;GENT
604;9050;GENT
605;2310;RIJKEVORSEL
606;8980;ZONNEBEKE
607;9160;LOKEREN
608;2960;BRECHT
609;2960;BRECHT
610;1982;ZEMST
611;2070;ZWIJNDRECHT
612;9160;LOKEREN
613;2520;RANST
614;2610;ANTWERPEN
615;2547;LINT
616;8450;BREDENE
617;2640;MORTSEL
618;9880;AALTER
619;9140;TEMSE
620;8970;POPERINGE
621;9910;AALTER
622;9160;LOKEREN
623;9052;GENT
624;9280;LEBBEKE
625;2820;BONHEIDEN
626;8730;BEERNEM
627;2820;BONHEIDEN
628;2040;ANTWERPEN
629;1830;MACHELEN
630;2960;BRECHT
631;9160;LOKEREN
632;2930;BRASSCHAAT
633;9420;ERPE-MERE
634;2250;OLEN
635;9940;EVERGEM
636;2400;MOL
637;2650;EDEGEM
638;3111;ROTSELAAR
639;9320;AALST
640;9340;LEDE
641;2570;DUFFEL
642;1980;ZEMST
643;8650;HOUTHULST
644;8570;ANZEGEM
645;8750;WINGENE
646;8730;BEERNEM
647;9080;LOCHRISTI
648;9880;AALTER
649;8930;MENEN
650;9220;HAMME
651;2400;MOL
652;2861;SINT-KATELIJNE-WAVER
653;9160;LOKEREN
654;9860;OOSTERZELE
655;2990;WUUSTWEZEL
656;9030;GENT
657;9230;WETTEREN
658;8930;MENEN
659;1785;MERCHTEM
660;9340;LEDE
661;9880;AALTER
662;9990;MALDEGEM
663;2180;ANTWERPEN
664;8800;ROESELARE
665;2221;HEIST-OP-DEN-BERG
666;2890;PUURS-SINT-AMANDS
667;2960;BRECHT
668;9260;WICHELEN
669;8902;IEPER
670;2160;WOMMELGEM
671;9520;SINT-LIEVENS-HOUTEM
672;9185;WACHTEBEKE
673;1600;SINT-PIETERS-LEEUW
674;9340;LEDE
675;3191;BOORTMEERBEEK
676;2440;GEEL
677;9230;WETTEREN
678;8900;IEPER
679;9260;WICHELEN
680;8750;WINGENE
681;3271;SCHERPENHEUVEL-ZICHEM
682;2990;WUUSTWEZEL
683;9190;STEKENE
684;1701;DILBEEK
685;9308;AALST
686;9820;MERELBEKE
687;3300;TIENEN
688;3110;ROTSELAAR
689;2340;BEERSE
690;8400;OOSTENDE
691;8400;OOSTENDE
692;9230;WETTEREN
693;9032;GENT
694;9032;GENT
695;9100;SINT-NIKLAAS
696;3001;LEUVEN
697;8020;OOSTKAMP
698;9032;GENT
699;3080;TERVUREN
700;8840;STADEN
701;8200;BRUGGE
702;1600;SINT-PIETERS-LEEUW
703;2920;KALMTHOUT
704;9000;GENT
705;2820;BONHEIDEN
706;8690;ALVERINGEM
707;9050;GENT
708;9750;KRUISEM
709;9890;GAVERE
710;9340;LEDE
711;2580;PUTTE
712;9420;ERPE-MERE
713;9280;LEBBEKE
714;9160;LOKEREN
715;9620;ZOTTEGEM
716;2800;MECHELEN
717;2220;HEIST-OP-DEN-BERG
718;9050;GENT
719;8510;KORTRIJK
720;8310;BRUGGE
721;9040;GENT
722;8370;BLANKENBERGE
723;9520;SINT-LIEVENS-HOUTEM
724;9000;GENT
725;2323;HOOGSTRATEN
726;8500;KORTRIJK
727;8450;BREDENE
728;2960;BRECHT
729;9340;LEDE
730;2800;MECHELEN
731;1840;LONDERZEEL
732;2580;PUTTE
733;2360;OUD-TURNHOUT
734;2880;BORNEM
735;1650;BEERSEL
736;2340;BEERSE
737;2970;SCHILDE
738;9340;LEDE
739;9170;SINT-GILLIS-WAAS
740;9340;LEDE
741;9880;AALTER
742;9820;MERELBEKE
743;2340;BEERSE
744;2960;BRECHT
745;8940;WERVIK
746;8450;BREDENE
747;2860;SINT-KATELIJNE-WAVER
748;3070;KORTENBERG
749;2860;SINT-KATELIJNE-WAVER
750;2860;SINT-KATELIJNE-WAVER
751;9520;SINT-LIEVENS-HOUTEM
752;8400;OOSTENDE
753;2180;ANTWERPEN
754;2860;SINT-KATELIJNE-WAVER
755;9240;ZELE
756;2100;ANTWERPEN
757;9050;GENT
758;2370;ARENDONK
759;8210;ZEDELGEM
760;2940;STABROEK
761;2520;RANST
762;9260;WICHELEN
763;8480;ICHTEGEM
764;2180;ANTWERPEN
765;3120;TREMELO
766;9250;WAASMUNSTER
767;8501;KORTRIJK
768;9820;MERELBEKE
769;1880;KAPELLE-OP-DEN-BOS
770;3070;KORTENBERG
771;9420;ERPE-MERE
772;9160;LOKEREN
773;8340;DAMME
774;9280;LEBBEKE
775;9420;ERPE-MERE
776;2920;KALMTHOUT
777;9090;MELLE
778;2870;PUURS-SINT-AMANDS
779;9880;AALTER
780;8400;OOSTENDE
781;9290;BERLARE
782;8500;KORTRIJK
783;8640;VLETEREN
784;9180;MOERBEKE
785;2960;BRECHT
786;2270;HERENTHOUT
787;8970;POPERINGE
788;9160;LOKEREN
789;2323;HOOGSTRATEN
790;2300;TURNHOUT
791;2920;KALMTHOUT
792;9050;GENT
793;3020;HERENT
794;8630;VEURNE
795;2323;HOOGSTRATEN
796;9030;GENT
797;9290;BERLARE
798;9052;GENT
799;2960;BRECHT
800;3012;LEUVEN
801;8940;WERVIK
802;2980;ZOERSEL
803;9040;GENT
804;8640;VLETEREN
805;2811;MECHELEN
806;2800;MECHELEN
807;9070;DESTELBERGEN
808;9240;ZELE
809;9031;GENT
810;2310;RIJKEVORSEL
811;8650;HOUTHULST
812;9041;GENT
813;2310;RIJKEVORSEL
814;9340;LEDE
815;2950;KAPELLEN
816;9140;TEMSE
817;2811;MECHELEN
818;2320;HOOGSTRATEN
819;2040;ANTWERPEN
820;8740;PITTEM
821;2920;KALMTHOUT
822;8650;HOUTHULST
823;9420;ERPE-MERE
824;2860;SINT-KATELIJNE-WAVER
825;9230;WETTEREN
826;2860;SINT-KATELIJNE-WAVER
827;1840;LONDERZEEL
828;9900;EEKLO
829;2990;WUUSTWEZEL
830;9090;MELLE
831;9770;KRUISEM
832;9810;NAZARETH
833;2630;AARTSELAAR
834;2920;KALMTHOUT
835;9260;WICHELEN
836;2870;PUURS-SINT-AMANDS
837;2490;BALEN
838;9040;GENT
839;9470;DENDERLEEUW
840;9250;WAASMUNSTER
841;9150;KRUIBEKE
842;2600;ANTWERPEN
843;2380;RAVELS
844;8301;KNOKKE-HEIST
845;9770;KRUISEM
846;8670;KOKSIJDE
847;2440;GEEL
848;9770;KRUISEM
849;2630;AARTSELAAR
850;2990;WUUSTWEZEL
851;9800;DEINZE
852;8300;KNOKKE-HEIST
853;2260;WESTERLO
854;9120;BEVEREN
855;2275;LILLE
856;2980;ZOERSEL
857;8020;OOSTKAMP
858;2930;BRASSCHAAT
859;9420;ERPE-MERE
860;2960;BRECHT
861;1800;VILVOORDE
862;2990;WUUSTWEZEL
863;8930;MENEN
864;9255;BUGGENHOUT
865;9200;DENDERMONDE
866;3020;HERENT
867;9070;DESTELBERGEN
868;9300;AALST
869;1831;MACHELEN
870;2018;ANTWERPEN
871;2040;ANTWERPEN
872;3060;BERTEM
873;3060;BERTEM
874;9220;HAMME
875;8570;ANZEGEM
876;8301;KNOKKE-HEIST
877;9982;SINT-LAUREINS
878;9790;WORTEGEM-PETEGEM
879;1861;MEISE
880;2920;KALMTHOUT
881;2440;GEEL
882;2960;BRECHT
883;9040;GENT
884;9160;LOKEREN
885;3020;HERENT
886;2242;ZANDHOVEN
887;2300;TURNHOUT
888;9112;SINT-NIKLAAS
889;2830;WILLEBROEK
890;8900;IEPER
891;3000;LEUVEN
892;9100;SINT-NIKLAAS
893;9100;SINT-NIKLAAS
894;2400;MOL
895;3000;LEUVEN
896;9620;ZOTTEGEM
897;2580;PUTTE
898;8550;ZWEVEGEM
899;2322;HOOGSTRATEN
900;1560;HOEILAART
901;8210;ZEDELGEM
902;8300;KNOKKE-HEIST
903;2930;BRASSCHAAT
904;2830;WILLEBROEK
905;9850;DEINZE
906;2470;RETIE
907;1500;HALLE
908;2390;MALLE
909;2590;BERLAAR
910;9300;AALST
911;2235;HULSHOUT
912;2260;WESTERLO
913;3191;BOORTMEERBEEK
914;9280;LEBBEKE
915;9300;AALST
916;9840;DE PINTE
917;2470;RETIE
918;3320;HOEGAARDEN
919;2580;PUTTE
920;2580;PUTTE
921;8550;ZWEVEGEM
922;2840;RUMST
923;9280;LEBBEKE
924;3190;BOORTMEERBEEK
925;2110;WIJNEGEM
926;2830;WILLEBROEK
927;2960;BRECHT
928;9850;DEINZE
929;9050;GENT
930;2840;RUMST
931;8800;ROESELARE
932;8370;BLANKENBERGE
933;1760;ROOSDAAL
934;2610;ANTWERPEN
935;1730;ASSE
936;2490;BALEN
937;2280;GROBBENDONK
938;9690;KLUISBERGEN
939;9280;LEBBEKE
940;2960;BRECHT
941;2900;SCHOTEN
942;2960;BRECHT
943;3012;LEUVEN
944;9100;SINT-NIKLAAS
945;8730;BEERNEM
946;2520;RANST
947;2491;BALEN
948;3020;HERENT
949;1785;MERCHTEM
950;9080;LOCHRISTI
951;9570;LIERDE
952;8310;BRUGGE
953;8480;ICHTEGEM
954;3370;BOUTERSEM
955;2300;TURNHOUT
956;8520;KUURNE
957;9300;AALST
958;2340;BEERSE
959;2640;MORTSEL
960;8480;ICHTEGEM
961;2230;HERSELT
962;2860;SINT-KATELIJNE-WAVER
963;2920;KALMTHOUT
964;9940;EVERGEM
965;2550;KONTICH
966;8930;MENEN
967;2520;RANST
968;3111;ROTSELAAR
969;9870;ZULTE
970;9041;GENT
971;1980;ZEMST
972;9552;HERZELE
973;2322;HOOGSTRATEN
974;8200;BRUGGE
975;8000;BRUGGE
976;9190;STEKENE
977;9140;TEMSE
978;8792;WAREGEM
979;9160;LOKEREN
980;9960;ASSENEDE
981;3665;AS
982;3930;HAMONT-ACHEL
983;3640;KINROOI
984;3660;OUDSBERGEN
985;3920;LOMMEL
986;3680;MAASEIK
987;3670;OUDSBERGEN
988;3520;ZONHOVEN
989;3990;PEER
990;3668;AS
991;3520;ZONHOVEN
992;3960;BREE
993;3650;DILSEN-STOKKEM
994;3670;OUDSBERGEN
995;3510;HASSELT
996;3700;TONGEREN
997;3630;MAASMECHELEN
998;3730;HOESELT
999;2430;LAAKDAL
1000;3740;BILZEN
1001;3960;BREE
1002;3600;GENK
1003;3830;WELLEN
1004;3500;HASSELT
1005;3680;MAASEIK
1006;3700;TONGEREN
1007;3560;LUMMEN
1008;3520;ZONHOVEN
1009;3722;KORTESSEM
1010;3630;MAASMECHELEN
1011;3600;GENK
1012;3700;TONGEREN
1013;3840;BORGLOON
1014;8470;GISTEL
1015;3740;BILZEN
1016;3650;DILSEN-STOKKEM
1017;3530;HOUTHALEN-HELCHTEREN
1018;3590;DIEPENBEEK
1019;3670;OUDSBERGEN
1020;3600;GENK
1021;3900;PELT
1022;3545;HALEN
1023;3700;TONGEREN
1024;8560;WEVELGEM
1025;3500;HASSELT
1026;3590;DIEPENBEEK
1027;3668;AS
1028;3830;WELLEN
1029;3740;BILZEN
1030;3620;LANAKEN
1031;3700;TONGEREN
1032;3590;DIEPENBEEK
1033;3910;PELT
1034;3950;BOCHOLT
1035;3630;MAASMECHELEN
1036;3740;BILZEN
1037;3920;LOMMEL
1038;3945;HAM
1039;2845;NIEL
1040;3294;DIEST
1041;8560;WEVELGEM
1042;3600;GENK
1043;2430;LAAKDAL
1044;3990;PEER
1045;3740;BILZEN
1046;3900;PELT
1047;3640;KINROOI
1048;3850;NIEUWERKERKEN
1049;2950;KAPELLEN
1050;3740;BILZEN
1051;3700;TONGEREN
1052;3650;DILSEN-STOKKEM
1053;2431;LAAKDAL
1054;3590;DIEPENBEEK
1055;3511;HASSELT
1056;3940;HECHTEL-EKSEL
1057;3600;GENK
1058;3590;DIEPENBEEK
1059;3950;BOCHOLT
1060;8560;WEVELGEM
1061;8820;TORHOUT
1062;3660;OUDSBERGEN
1063;3970;LEOPOLDSBURG
1064;3910;PELT
1065;3560;LUMMEN
1066;3980;TESSENDERLO
1067;8470;GISTEL
1068;3980;TESSENDERLO
1069;3520;ZONHOVEN
1070;3740;BILZEN
1071;3220;HOLSBEEK
1072;2950;KAPELLEN
1073;3680;MAASEIK
1074;3630;MAASMECHELEN
1075;3700;TONGEREN
1076;3590;DIEPENBEEK
1077;3740;BILZEN
1078;2560;NIJLEN
1079;3665;AS
1080;3600;GENK
1081;3990;PEER
1082;3980;TESSENDERLO
1083;3990;PEER
1084;3511;HASSELT
1085;3900;PELT
1086;3690;ZUTENDAAL
1087;3620;LANAKEN
1088;3640;KINROOI
1089;3990;PEER
1090;3900;PELT
1091;3500;HASSELT
1092;8870;IZEGEM
1093;3520;ZONHOVEN
1094;3570;ALKEN
1095;3512;HASSELT
1096;3600;GENK
1097;3450;GEETBETS
1098;3680;MAASEIK
1099;3650;DILSEN-STOKKEM
1100;8820;TORHOUT
1101;2660;ANTWERPEN
1102;3511;HASSELT
1103;3621;LANAKEN
1104;2910;ESSEN
1105;8560;WEVELGEM
1106;3900;PELT
1107;3210;LUBBEEK
1108;3700;TONGEREN
1109;3600;GENK
1110;3665;AS
1111;3980;TESSENDERLO
1112;3630;MAASMECHELEN
1113;3900;PELT
1114;8560;WEVELGEM
1115;3130;BEGIJNENDIJK
1116;3570;ALKEN
1117;3500;HASSELT
1118;2530;BOECHOUT
1119;3550;HEUSDEN-ZOLDER
1120;3520;ZONHOVEN
1121;3511;HASSELT
1122;3740;BILZEN
1123;8434;MIDDELKERKE
1124;2560;NIJLEN
1125;3900;PELT
1126;3583;BERINGEN
1127;2530;BOECHOUT
1128;3473;KORTENAKEN
1129;2620;HEMIKSEM
1130;3500;HASSELT
1131;2620;HEMIKSEM
1132;3384;GLABBEEK
1133;3960;BREE
1134;8430;MIDDELKERKE
1135;8820;TORHOUT
1136;3560;LUMMEN
1137;3212;LUBBEEK
1138;3460;BEKKEVOORT
1139;3500;HASSELT
1140;3971;LEOPOLDSBURG
1141;3631;MAASMECHELEN
1142;1910;KAMPENHOUT
1143;8600;DIKSMUIDE
1144;3128;TREMELO
1145;3660;OUDSBERGEN
1146;3930;HAMONT-ACHEL
1147;3940;HECHTEL-EKSEL
1148;3910;PELT
1149;3665;AS
1150;3680;MAASEIK
1151;3990;PEER
1152;3680;MAASEIK
1153;3668;AS
1154;3960;BREE
1155;3670;OUDSBERGEN
1156;3700;TONGEREN
1157;3990;PEER
1158;3730;HOESELT
1159;3990;PEER
1160;3582;BERINGEN
1161;3945;HAM
1162;3581;BERINGEN
1163;3583;BERINGEN
1164;3550;HEUSDEN-ZOLDER
1165;3945;HAM
1166;3670;OUDSBERGEN
1167;3582;BERINGEN
1168;3971;LEOPOLDSBURG
1169;3550;HEUSDEN-ZOLDER
1170;3550;HEUSDEN-ZOLDER
1171;3550;HEUSDEN-ZOLDER
1172;3970;LEOPOLDSBURG
1173;3530;HOUTHALEN-HELCHTEREN
1174;3530;HOUTHALEN-HELCHTEREN
1175;2430;LAAKDAL
1176;3980;TESSENDERLO
1177;2431;LAAKDAL
1178;3742;BILZEN
1179;3740;BILZEN
1180;3980;TESSENDERLO
1181;3590;DIEPENBEEK
1182;3740;BILZEN
1183;3700;TONGEREN
1184;3590;DIEPENBEEK
1185;3700;TONGEREN
1186;3700;TONGEREN
1187;3740;BILZEN
1188;3740;BILZEN
1189;3540;HERK-DE-STAD
1190;3740;BILZEN
1191;3722;KORTESSEM
1192;3724;KORTESSEM
1193;3724;KORTESSEM
1194;3730;HOESELT
1195;3650;DILSEN-STOKKEM
1196;3650;DILSEN-STOKKEM
1197;3620;LANAKEN
1198;3690;ZUTENDAAL
1199;3620;LANAKEN
1200;3800;SINT-TRUIDEN
1201;3630;MAASMECHELEN
1202;3800;SINT-TRUIDEN
1203;3631;MAASMECHELEN
1204;3630;MAASMECHELEN
1205;3840;BORGLOON
1206;3510;HASSELT
1207;3890;GINGELOM
1208;3511;HASSELT
1209;3850;NIEUWERKERKEN
1210;3511;HASSELT
1211;3500;HASSELT
1212;3511;HASSELT
1213;3520;ZONHOVEN
1214;3600;GENK
1215;3600;GENK
1216;3680;MAASEIK
1217;3630;MAASMECHELEN
1218;3630;MAASMECHELEN
1219;3950;BOCHOLT
1220;3550;HEUSDEN-ZOLDER
1221;3460;BEKKEVOORT
1222;3380;GLABBEEK
1223;3381;GLABBEEK
1224;3128;TREMELO
1225;3210;LUBBEEK
1226;3210;LUBBEEK
1227;3211;LUBBEEK
1228;3210;LUBBEEK
1229;3450;GEETBETS
1230;3220;HOLSBEEK
1231;3220;HOLSBEEK
1232;3220;HOLSBEEK
1233;3390;TIELT-WINGE
1234;3471;KORTENAKEN
1235;3053;OUD-HEVERLEE
1236;1540;HERNE
1237;1670;PEPINGEN
1238;3404;LANDEN
1239;3210;LUBBEEK
1240;3210;LUBBEEK
1241;3210;LUBBEEK
1242;3293;DIEST
1243;3128;TREMELO
1244;1570;GALMAARDEN
1245;1910;KAMPENHOUT
1246;1820;STEENOKKERZEEL
1247;1910;KAMPENHOUT
1248;3400;LANDEN
1249;2530;BOECHOUT
1250;2560;NIJLEN
1251;2560;NIJLEN
1252;2560;NIJLEN
1253;2560;NIJLEN
1254;2560;NIJLEN
1255;2560;NIJLEN
1256;2560;NIJLEN
1257;2660;ANTWERPEN
1258;2020;ANTWERPEN
1259;9060;ZELZATE
1260;2560;NIJLEN
1261;2530;BOECHOUT
1262;2950;KAPELLEN
1263;2910;ESSEN
1264;2910;ESSEN
1265;2910;ESSEN
1266;2290;VORSELAAR
1267;2290;VORSELAAR
1268;2910;ESSEN
1269;2020;ANTWERPEN
1270;2910;ESSEN
1271;2950;KAPELLEN
1272;2845;NIEL
1273;2560;NIJLEN
1274;8600;DIKSMUIDE
1275;8470;GISTEL
1276;8470;GISTEL
1277;8470;GISTEL
1278;8470;GISTEL
1279;8470;GISTEL
1280;8470;GISTEL
1281;8830;HOOGLEDE
1282;8490;JABBEKE
1283;8680;KOEKELARE
1284;8434;MIDDELKERKE
1285;8460;OUDENBURG
1286;8820;TORHOUT
1287;8820;TORHOUT
1288;8530;HARELBEKE
1289;8560;WEVELGEM
1290;8560;WEVELGEM
1291;8610;KORTEMARK
1292;8820;TORHOUT
1293;8820;TORHOUT
1294;8880;LEDEGEM
1295;8600;DIKSMUIDE
1296;8560;WEVELGEM
1297;8820;TORHOUT
1298;8870;IZEGEM
1299;8870;IZEGEM
1300;8870;IZEGEM
"""